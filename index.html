<html>
<head>
</head>
<body>
  <h1>OpenSwitchMaps Web version test</h1>

    <h2>Map info</h2>
  <ul>
    <li>Prev URL: <i><span id="showurl"></span></i></li>
    <li>Lat: <i><span id="lat"><span></i></li>
    <li>Lon: <i><span id="lon"><span></i></li>
    <li>Zoom: <i><span id="zoom"><span></i></li>
  </ul>
  
  <h2>Switch to another map service ...</h2>
  <ul class="maps">
    <li><a id="googlemaps" href="https://www.google.com/maps/">Google Maps</a></li>
    <li><a id="openstreetmap" href="https://www.openstreetmap.org/">OpenStreetMap</a></li>
    <li><a id="gsimap" href="https://maps.gsi.go.jp/">地理院地図</a></li>
    <li><a id="mapillary" href="https://www.mapillary.com/app/">Mapillary</a></li>
  </ul>
      
  <h2>How to use</h2>
  <ol>
    <li>Bookmark this bookmarklet</li>
      <code>javascript:(function(){ window.location.href="http://htmlpreview.github.io/?https://github.com/tankaru/OpenSwitchMapsWeb/blob/master/index.html#"+location.href;})();</code>
    <li>Open Map service (now supports only Google maps and OpenStreetMap)</li>
    <li>Open saved Bookmarklet</li>
    <li>You will move to a web page(here). And you will get links to jump to Google maps and OpenStreetMap</li>
  </ol>
<script>
    function getLatLonZoom(url) {
      let match;
      if (match = url.match(/google.*maps.*@(-?\d[0-9.]*),(-?\d[0-9.]*),(\d{1,2})[.z]/)) {
        const [, lat, lon, zoom] = match;
        return [lat, lon, zoom];
      } else if (match = url.match(/google.*maps.*@(-?\d[0-9.]*),(-?\d[0-9.]*),(\d[0-9.]*)[m]/)) {
        let [, lat, lon, zoom] = match;
        zoom = Math.round(-1.4436 * Math.log(zoom) + 26.871);
        return [lat, lon, zoom];
      } else if (match = url.match(/google.*maps.*@(-?\d[0-9.]*),(-?\d[0-9.]*),([0-9]*)[a],[0-9.]*y/)) {
        let [, lat, lon, zoom] = match;
        zoom = Math.round(-1.44 * Math.log(zoom) + 27.5);
        return [lat, lon, zoom];
      } else if (match = url.match(/www\.openstreetmap\.org.*map=(\d{1,2})\/(-?\d[0-9.]*)\/(-?\d[0-9.]*)/)) {
        const [, zoom, lat, lon] = match;
        return [lat, lon, zoom];
      } else if (match = url.match(/maps\.gsi\.go\.jp.*#(\d{1,2})\/(-?\d[0-9.]*)\/(-?\d[0-9.]*)/)) {
        const [, zoom, lat, lon] = match;
        return [lat, lon, zoom];
      } else if (match = url.match(/www\.mapillary\.com.*lat=(-?\d[0-9.]*)&lng=(-?\d[0-9.]*)&z=(\d{1,2})/)) {
        const [, lat, lon, zoom] = match;
        return [lat, lon, zoom];
      }
  }
  
  let elementUrl = document.getElementById("showurl");
  let prevUrls = location.href.match(/#(.*)$/);
  let prevUrl = prevUrls[1];
  elementUrl.innerHTML = prevUrl;
  
  let [lat, lon, zoom] = getLatLonZoom(prevUrl);
  document.getElementById("lat").innerHTML = lat;
  document.getElementById("lon").innerHTML = lon;
  document.getElementById("zoom").innerHTML = zoom;
  
  document.getElementById("googlemaps").setAttribute("href",'https://www.google.com/maps/@' + lat + ',' + lon + ',' + zoom + 'z');
  document.getElementById("openstreetmap").setAttribute("href",'https://www.openstreetmap.org/#map=' + zoom + '/' + lat + '/' + lon);
  document.getElementById("gsimap").setAttribute("href",'https://maps.gsi.go.jp/#' + zoom + '/' + lat + '/' + lon + '/');
  document.getElementById("mapillary").setAttribute("href",'https://www.mapillary.com/app/?lat=' + lat + '&lng=' + lon + '&z=' + zoom);
  
  

</script>
      <style>
          .maps {
            display: table-cell;
            white-space: nowrap;
        }
      </style>
      
</body>
</html>
